
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples/Models/plot_model_1d.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_examples_Models_plot_model_1d.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_Models_plot_model_1d.py:


1D Model with an infinite halfspace
-----------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 7-17

.. code-block:: default

    from copy import deepcopy
    from geobipy import StatArray
    from geobipy import Model1D
    from geobipy import Distribution
    from geobipy import FdemData
    import matplotlib.pyplot as plt
    import numpy as np
    import h5py
    from geobipy import hdfRead








.. GENERATED FROM PYTHON SOURCE LINES 18-20

Instantiate the 1D Model with a Half Space
++++++++++++++++++++++++++++++++++++++++++

.. GENERATED FROM PYTHON SOURCE LINES 20-32

.. code-block:: default


    # Make a test model with 10 layers, and increasing parameter values
    nLayers = 2
    par = StatArray(np.linspace(0.001, 0.02, nLayers),
                    "Conductivity", "$\\frac{S}{m}$")
    thk = StatArray(np.full(nLayers, fill_value=10.0))
    thk[-1] = np.inf
    mod = Model1D(parameters=par, widths=thk)

    # plt.figure()
    # mod.plotGrid(transpose=True, flip=True)








.. GENERATED FROM PYTHON SOURCE LINES 33-40

Randomness and Model Perturbations
++++++++++++++++++++++++++++++++++
We can set the priors on the 1D model by assigning minimum and maximum layer
depths and a maximum number of layers.  These are used to create priors on
the number of cells in the model, a new depth interface, new parameter values
and the vertical gradient of those parameters.
The halfSpaceValue is used as a reference value for the parameter prior.

.. GENERATED FROM PYTHON SOURCE LINES 40-53

.. code-block:: default

    prng = np.random.RandomState(0)
    # Set the priors
    mod.set_priors(halfSpaceValue=0.01,
                  min_edge=1.0,
                  max_edge=150.0,
                  max_cells=30,
                  parameterPrior=True,
                  gradientPrior=True,
                  prng=prng)

    # plt.figure()
    # mod.plot(flipY=True)








.. GENERATED FROM PYTHON SOURCE LINES 54-55

We can evaluate the prior of the model using depths only

.. GENERATED FROM PYTHON SOURCE LINES 55-61

.. code-block:: default

    print('Log probability of the Model given its priors: ',
          mod.priorProbability(False, False, log=True))
    # Or with priors on its parameters, and parameter gradient with depth.
    print('Log probability of the Model given its priors: ',
          mod.priorProbability(True, True, log=True))





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Log probability of the Model given its priors:  -13.358381323561012
    Log probability of the Model given its priors:  -20.111609194656108




.. GENERATED FROM PYTHON SOURCE LINES 62-64

To propose new models, we specify the probabilities of creating, removing, perturbing, and not changing
a layer interface

.. GENERATED FROM PYTHON SOURCE LINES 64-69

.. code-block:: default

    pProposal = Distribution('LogNormal', 0.01, np.log(2.0)**2.0,
                             linearSpace=True, prng=prng)
    mod.setProposals(probabilities=[0.25, 0.25, 0.5, 0.25],
                     parameterProposal=pProposal, prng=prng)








.. GENERATED FROM PYTHON SOURCE LINES 70-71

We can then perturb the layers of the model

.. GENERATED FROM PYTHON SOURCE LINES 71-80

.. code-block:: default

    remapped, perturbed = mod.perturb()

    # ################################################################################
    # fig = plt.figure(figsize=(8, 6))
    # ax = plt.subplot(121)
    # mod.pcolor(transpose=True, flip=True)  # , grid=True)
    # ax = plt.subplot(122)
    # perturbed.pcolor(transpose=True, flip=True)  # , grid=True)








.. GENERATED FROM PYTHON SOURCE LINES 81-82

We can evaluate the prior of the model using depths only

.. GENERATED FROM PYTHON SOURCE LINES 82-89

.. code-block:: default

    print('Log probability of the Model given its priors: ',
          perturbed.priorProbability(False, False, log=True))
    # Or with priors on its parameters, and parameter gradient with depth.
    print('Log probability of the Model given its priors: ',
          perturbed.priorProbability(True, True, log=True))






.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Log probability of the Model given its priors:  -13.358381323561012
    Log probability of the Model given its priors:  -18.64550324345332




.. GENERATED FROM PYTHON SOURCE LINES 90-104

Perturbing a model multiple times
+++++++++++++++++++++++++++++++++
In the stochasitic inference process, we perturb the model structure,
and parameter values, multiple times.
Each time the model is perturbed, we can record its state
in a posterior distribution.

For a 1D model, the parameter posterior is a 2D hitmap with depth in one dimension
and the parameter value in the other.
We also attach a 1D histogram for the number of layers,
and a 1D histogram for the locations of interfaces.

Since we have already set the priors on the Model, we can set the posteriors
based on bins from from the priors.

.. GENERATED FROM PYTHON SOURCE LINES 104-109

.. code-block:: default


    mod.setPosteriors()

    mod0 = deepcopy(mod)








.. GENERATED FROM PYTHON SOURCE LINES 110-111

Now we randomly perturb the model, and update its posteriors.

.. GENERATED FROM PYTHON SOURCE LINES 111-122

.. code-block:: default

    mod.updatePosteriors()
    for i in range(1001):
        remapped, perturbed = mod.perturb()

        # And update the model posteriors
        perturbed.updatePosteriors()

        mod = perturbed

    # mod.par.posterior._counts[:, :] = np.random.randn(*mod.par.posterior.shape)








.. GENERATED FROM PYTHON SOURCE LINES 123-127

We can now plot the posteriors of the model.

Remember in this case, we are simply perturbing the model structure and parameter values
The proposal for the parameter values is fixed and centred around a single value.

.. GENERATED FROM PYTHON SOURCE LINES 127-155

.. code-block:: default

    fig = plt.figure(figsize=(8, 6))

    plt.subplot(131)
    mod.nCells.posterior.plot()
    ax = plt.subplot(132)
    mod.par.posterior.pcolor(cmap='gray_r', xscale='log', noColorbar=True, flipY=True)
    plt.subplot(133, sharey=ax)
    mod.edges.posterior.plot(rotate=True, flipY=True)

    fig = plt.figure(figsize=(8, 6))
    gs = fig.add_gridspec(nrows=1, ncols=1)
    ax = mod.init_posterior_plots(gs[0, 0])
    mod.plot_posteriors(axes=ax,
                        edges_kwargs = {
                            "rotate":True,
                            "flipY":True
                        },
                        parameter_kwargs = {
                            "cmap": 'gray_r',
                            "xscale": 'log',
                            "noColorbar": True,
                            "flipY": True,
                            'credible_interval_kwargs':{
                                  'reciprocate':True
                            }
                        },
                        best = mod)




.. rst-class:: sphx-glr-horizontal


    *

      .. image:: /examples/Models/images/sphx_glr_plot_model_1d_001.png
          :alt: plot model 1d
          :class: sphx-glr-multi-img

    *

      .. image:: /examples/Models/images/sphx_glr_plot_model_1d_002.png
          :alt: plot model 1d
          :class: sphx-glr-multi-img





.. GENERATED FROM PYTHON SOURCE LINES 156-157

We can interpolate the Model to another mesh.

.. GENERATED FROM PYTHON SOURCE LINES 157-161

.. code-block:: default

    mesh = mod.par.posterior
    x = mod.piecewise_constant_interpolate(mod.par, mesh, axis=1)

    plt.show()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  2.492 seconds)


.. _sphx_glr_download_examples_Models_plot_model_1d.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_model_1d.py <plot_model_1d.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_model_1d.ipynb <plot_model_1d.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
